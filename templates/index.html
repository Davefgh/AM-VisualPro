<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Automata Visualizer Pro</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="toast" class="toast">Notification</div>

    <nav class="navbar">
      <div class="brand"><span>âš¡</span> Automata Pro</div>
      <div class="nav-actions">
        <button class="btn" onclick="window.app.clearAll()">
          <span>ğŸ—‘ï¸</span> Clear
        </button>
        <button
          class="btn"
          onclick="document.getElementById('importFile').click()"
        >
          <span>ğŸ“‚</span> Import JSON
        </button>
        <button
          class="btn"
          onclick="document.getElementById('importJFLAP').click()"
        >
          <span>ğŸ“„</span> Import JFLAP
        </button>
        <button class="btn primary" onclick="window.app.exportDFA()">
          <span>ğŸ’¾</span> Export
        </button>

        <input
          type="file"
          id="importFile"
          style="display: none"
          accept=".json"
          onchange="window.app.importDFA(event)"
        />
        <input
          type="file"
          id="importJFLAP"
          style="display: none"
          accept=".jff,.xml"
          onchange="window.app.importJFLAP(event)"
        />
      </div>
    </nav>

    <div class="main-container">
      <div class="floating-tools">
        <button
          class="tool-btn active"
          data-mode="addState"
          data-tooltip="Add State (Click)"
        >
          âšª
        </button>
        <button
          class="tool-btn"
          data-mode="addTransition"
          data-tooltip="Add Transition (Drag)"
        >
          â†—ï¸
        </button>
        <button
          class="tool-btn"
          data-mode="setStart"
          data-tooltip="Set Start State"
        >
          ğŸ
        </button>
        <button
          class="tool-btn"
          data-mode="toggleFinal"
          data-tooltip="Toggle Final State"
        >
          â—
        </button>
        <hr
          style="
            border: 0;
            border-top: 1px solid var(--panel-border);
            width: 100%;
            margin: 4px 0;
          "
        />
        <button
          class="tool-btn"
          data-action="delete"
          data-tooltip="Delete Selected"
          style="color: var(--error)"
        >
          ğŸ—‘ï¸
        </button>
      </div>

      <div class="canvas-wrapper">
        <canvas id="canvas"></canvas>

        <div id="simControls" class="sim-controls hidden">
          <div id="simDisplay" class="sim-display"></div>
          <button class="sim-btn" onclick="window.app.stepSimulation(-1)">
            â—€
          </button>
          <button class="sim-btn play" onclick="window.app.autoSimulation()">
            â–¶
          </button>
          <button class="sim-btn" onclick="window.app.stepSimulation(1)">
            â–¶|
          </button>
          <button class="sim-btn stop" onclick="window.app.stopSimulation()">
            â—¼
          </button>
          <div
            id="simStatus"
            style="
              font-size: 0.8rem;
              font-weight: 600;
              margin-left: 10px;
              color: var(--text-muted);
            "
          ></div>
        </div>

        <div class="legend">
          <div class="legend-item">
            <span
              class="legend-dot"
              style="background: var(--text-main)"
            ></span>
            Normal
          </div>
          <div class="legend-item">
            <span
              class="legend-dot"
              style="background: var(--success); border-color: var(--success)"
            ></span>
            Start
          </div>
          <div class="legend-item">
            <span
              class="legend-dot"
              style="
                background: transparent;
                border-color: var(--primary);
                border-width: 3px;
              "
            ></span>
            Final
          </div>
        </div>
      </div>

      <div class="config-panel">
        <div class="panel-section">
          <h3>âš™ï¸ Configuration</h3>
          <div class="input-group">
            <label>Alphabet (Î£)</label>
            <input
              type="text"
              id="alphabetInput"
              value="0,1"
              placeholder="e.g., a,b"
            />
          </div>
          <button
            class="btn"
            style="width: 100%"
            onclick="window.app.updateAlphabet()"
          >
            Update Alphabet
          </button>
        </div>

        <div class="panel-section">
          <h3>ğŸ Debugger</h3>
          <div class="input-group">
            <label>Input String</label>
            <input type="text" id="simulateInput" placeholder="e.g., 0110" />
          </div>
          <button
            class="btn primary"
            style="width: 100%"
            onclick="window.app.startSimulation()"
          >
            Load & Debug
          </button>
        </div>

        <div class="panel-section">
          <h3>ğŸ§ª Test Suite</h3>
          <div class="input-group">
            <label>Batch Strings (One per line)</label>
            <textarea
              id="testInput"
              rows="5"
              placeholder="01&#10;110"
            ></textarea>
          </div>
          <button
            class="btn"
            style="width: 100%"
            onclick="window.app.runBatchTests()"
          >
            Run Suite
          </button>
          <div
            id="testResults"
            style="margin-top: 10px; font-size: 0.85rem"
          ></div>
        </div>

        <div class="panel-section">
          <h3>ğŸ“‰ Minimization</h3>
          <button
            class="btn"
            style="
              width: 100%;
              background: var(--secondary);
              color: white;
              border: none;
            "
            onclick="window.app.minimizeDFA()"
          >
            Visualize Minimization
          </button>
        </div>
      </div>
    </div>

    <!-- Minimization Modal -->
    <div id="minModalOverlay" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h2>Minimization Steps (Hopcroft's)</h2>
          <button class="modal-close" onclick="window.app.closeMinModal()">
            Ã—
          </button>
        </div>
        <div class="modal-body" id="minStepsBody">
          <!-- Steps will be injected here -->
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='js/dfa.js') }}"></script>
    <script src="{{ url_for('static', filename='js/renderer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
  </body>
</html>
